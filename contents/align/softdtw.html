

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Soft-DTW &#8212; Machine Learning for Time Series</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'contents/align/softdtw';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Alignment-based Metrics in Machine Learning" href="align4ml.html" />
    <link rel="prev" title="Dynamic Time Warping" href="dtw.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../foreword.html">
  
  
  
  
  
  
    <p class="title logo__title">Machine Learning for Time Series</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../foreword.html">
                    Foreword
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">Alignment-based metrics</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dtw.html">Dynamic Time Warping</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Soft-DTW</a></li>
<li class="toctree-l2"><a class="reference internal" href="align4ml.html">Alignment-based Metrics in Machine Learning</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deep/intro.html">Dedicated neural-network architectures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conclu.html">Conclusion</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/rtavenar/ml4ts_ensai" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/rtavenar/ml4ts_ensai/issues/new?title=Issue%20on%20page%20%2Fcontents/align/softdtw.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/contents/align/softdtw.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Soft-DTW</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">Definition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#soft-alignment-path">Soft-Alignment Path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties">Properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-similarity-measures">Related Similarity Measures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#barycenters">Barycenters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="soft-dtw">
<span id="sec-softdtw"></span><h1>Soft-DTW<a class="headerlink" href="#soft-dtw" title="Permalink to this heading">#</a></h1>
<p>One strong limitation of Dynamic Time Warping is that it cannot be
differentiated everywhere because of the min operator that is used throughout
the computations.
This limitation is especially problematic given the importance of
gradient-based optimization in Machine Learning.</p>
<p>Soft-DTW <span id="id1">[<a class="reference internal" href="#id10" title="Marco Cuturi and Mathieu Blondel. Soft-DTW: a differentiable loss function for time-series. In Proceedings of the International Conference on Machine Learning, 894–903. JMLR. org, 2017.">Cuturi and Blondel, 2017</a>]</span> has been introduced as a way to mitigate this
limitation.</p>
<section id="definition">
<h2>Definition<a class="headerlink" href="#definition" title="Permalink to this heading">#</a></h2>
<p>The formal definition for soft-DTW is the following:</p>
<div class="amsmath math notranslate nohighlight" id="equation-d5a3e217-aff6-4252-a4c6-32a894247d6f">
<span class="eqno">(5)<a class="headerlink" href="#equation-d5a3e217-aff6-4252-a4c6-32a894247d6f" title="Permalink to this equation">#</a></span>\[\begin{equation}
\text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}^\prime) =
    \min_{\pi \in \mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)}{}^\gamma
        \sum_{(i, j) \in \pi} d(x_i, x^\prime_j)^2
\label{eq:softdtw}
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(\min{}^\gamma\)</span> is the soft-min operator parametrized by a smoothing
factor <span class="math notranslate nohighlight">\(\gamma\)</span>.</p>
<div class="admonition-a-note-on-soft-min admonition">
<p class="admonition-title">A note on soft-min</p>
<p>The soft-min operator <span class="math notranslate nohighlight">\(\min{}^\gamma\)</span> is defined as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-a3841f69-6ac6-4010-9643-dd6d2c1b2e15">
<span class="eqno">(6)<a class="headerlink" href="#equation-a3841f69-6ac6-4010-9643-dd6d2c1b2e15" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \min{}^\gamma(a_1, \dots, a_n) = - \gamma \log \sum_i e^{-a_i / \gamma}
\end{equation}\]</div>
<p>Note that when gamma tends to <span class="math notranslate nohighlight">\(0^+\)</span>, the term corresponding to the lower <span class="math notranslate nohighlight">\(a_i\)</span>
value will dominate other terms in the sum, and the soft-min then tends to the
hard minimum.</p>
</div>
<p>Typically, we have:</p>
<div class="amsmath math notranslate nohighlight" id="equation-41b14c95-ed0f-4ab3-9a2c-497a7c58f16d">
<span class="eqno">(7)<a class="headerlink" href="#equation-41b14c95-ed0f-4ab3-9a2c-497a7c58f16d" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}^\prime)
    \xrightarrow{\gamma \to 0^+} DTW(\mathbf{x}, \mathbf{x}^\prime)^2 \, .
\end{equation}\]</div>
<p>However, contrary to DTW, soft-DTW – being differentiable everywhere – can be
used as a loss in neural networks.
This use-case is discussed in more details in our <a class="reference internal" href="align4ml.html#sec-forecasting"><span class="std std-ref">Forecasting</span></a>
section.</p>
</section>
<section id="soft-alignment-path">
<h2>Soft-Alignment Path<a class="headerlink" href="#soft-alignment-path" title="Permalink to this heading">#</a></h2>
<p>Let us denote by <span class="math notranslate nohighlight">\(A_\gamma\)</span> the “soft path” matrix that informs, for each pair
<span class="math notranslate nohighlight">\((i, j)\)</span>, how much it will be taken into account in the matching.
<span class="math notranslate nohighlight">\(A_\gamma\)</span> can be interpreted as a weighted average of paths in
<span class="math notranslate nohighlight">\(\mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)\)</span>:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b037cba5-f1ba-4cb0-83fa-372ec67c6b1c">
<span class="eqno">(8)<a class="headerlink" href="#equation-b037cba5-f1ba-4cb0-83fa-372ec67c6b1c" title="Permalink to this equation">#</a></span>\[\begin{eqnarray}
A_\gamma =&amp; \, \mathbb{E}_{\gamma}[A] \\
=&amp; \, \frac{1}{k_{\mathrm{GA}}^{\gamma}(\mathbf{x}, \mathbf{x}^\prime)} \sum_{\pi \in \mathcal{A}(\mathbf{x}, \mathbf{x}^\prime)} e^{-\langle A_\pi, D_2(\mathbf{x}, \mathbf{x}^\prime) / \gamma\rangle} A_\pi \, ,
\end{eqnarray}\]</div>
<p>where <span class="math notranslate nohighlight">\(k_{\mathrm{GA}}^{\gamma}(\mathbf{x}, \mathbf{x}^\prime)\)</span> can be
seen as a normalization factor (see <a class="reference internal" href="align4ml.html#sec-gak"><span class="std std-ref">Global Alignment Kernel</span></a> section for more
details) and <span class="math notranslate nohighlight">\(D_2(\mathbf{x}, \mathbf{x}^\prime)\)</span> is a matrix that stores
squared distances <span class="math notranslate nohighlight">\(d(x_i, x^\prime_j)^2\)</span></p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;svg&#39;
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_constraints</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sz</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">sz</span> <span class="o">-</span> <span class="mf">.5</span><span class="p">],</span> <span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">pos</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="mf">.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="n">sz</span> <span class="o">-</span> <span class="mf">.5</span><span class="p">],</span>
                 <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">plot_path</span><span class="p">(</span><span class="n">s_y1</span><span class="p">,</span> <span class="n">s_y2</span><span class="p">,</span> <span class="n">path_matrix</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">sz</span> <span class="o">=</span> <span class="n">s_y1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># definitions for the axes</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span>
    <span class="n">w_ts</span> <span class="o">=</span> <span class="n">h_ts</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="n">left_h</span> <span class="o">=</span> <span class="n">left</span> <span class="o">+</span> <span class="n">w_ts</span> <span class="o">+</span> <span class="mf">0.02</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">=</span> <span class="mf">0.65</span>
    <span class="n">bottom_h</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">+</span> <span class="mf">0.02</span>

    <span class="n">rect_s_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">w_ts</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    <span class="n">rect_gram</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">]</span>
    <span class="n">rect_s_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">left_h</span><span class="p">,</span> <span class="n">bottom_h</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">h_ts</span><span class="p">]</span>

    <span class="n">ax_gram</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_gram</span><span class="p">)</span>
    <span class="n">ax_s_x</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_s_x</span><span class="p">)</span>
    <span class="n">ax_s_y</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">rect_s_y</span><span class="p">)</span>

    <span class="n">ax_gram</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">path_matrix</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="n">ax_gram</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax_gram</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">ax_s_x</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="n">s_y2</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
    <span class="n">ax_s_x</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax_s_x</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">sz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">ax_s_y</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">-</span> <span class="n">s_y1</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">sz</span><span class="p">),</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.</span><span class="p">)</span>
    <span class="n">ax_s_y</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
    <span class="n">ax_s_y</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">sz</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">tslearn</span> <span class="kn">import</span> <span class="n">metrics</span>

<span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">s_x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;../data/sample_series.txt&quot;</span><span class="p">)</span>
<span class="n">s_y1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">s_x</span><span class="p">,</span> <span class="n">s_x</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">s_y2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">s_x</span><span class="p">,</span> <span class="n">s_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">sz</span> <span class="o">=</span> <span class="n">s_y1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">gamma</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]:</span>
    <span class="n">alignment</span><span class="p">,</span> <span class="n">sim</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">soft_dtw_alignment</span><span class="p">(</span><span class="n">s_y1</span><span class="p">,</span> <span class="n">s_y2</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
    <span class="n">plot_path</span><span class="p">(</span><span class="n">s_y1</span><span class="p">,</span> <span class="n">s_y2</span><span class="p">,</span> <span class="n">alignment</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma=</span><span class="si">{:.1f}</span><span class="s2">$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/1bf570151c0b140c7504497ecadfc2d87b4695f5273e532de930b5da4000a374.svg" src="../../_images/1bf570151c0b140c7504497ecadfc2d87b4695f5273e532de930b5da4000a374.svg" /><img alt="../../_images/0d2e802c46f1ef4c5ca52b03f717649f32af06f9d98a4ac4c0530214c3a4eaa1.svg" src="../../_images/0d2e802c46f1ef4c5ca52b03f717649f32af06f9d98a4ac4c0530214c3a4eaa1.svg" /><img alt="../../_images/7bfdc2d5a8166185e20f95844650fa95c865e9ea29e5880e6c95f6eff347c9a2.svg" src="../../_images/7bfdc2d5a8166185e20f95844650fa95c865e9ea29e5880e6c95f6eff347c9a2.svg" /></div>
</div>
<p><span class="math notranslate nohighlight">\(A_\gamma\)</span> can be computed with complexity <span class="math notranslate nohighlight">\(O(mn)\)</span> and there is a link between
this matrix and the gradients of the soft-DTW similarity measure:</p>
<div class="amsmath math notranslate nohighlight" id="equation-c7b0a63f-1766-4745-b68b-aa3001803723">
<span class="eqno">(9)<a class="headerlink" href="#equation-c7b0a63f-1766-4745-b68b-aa3001803723" title="Permalink to this equation">#</a></span>\[\begin{equation}
\nabla_{\mathbf{x}} \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}^\prime) =
    \left(\frac{\partial D_2(\mathbf{x}, \mathbf{x}^\prime)}{\partial \mathbf{x}} \right)^T A_\gamma
\end{equation}\]</div>
</section>
<section id="properties">
<h2>Properties<a class="headerlink" href="#properties" title="Permalink to this heading">#</a></h2>
<p>As discussed in <span id="id2">[<a class="reference internal" href="#id15" title="Hicham Janati, Marco Cuturi, and Alexandre Gramfort. Spatio-temporal alignments: optimal transport through space and time. In Proceedings of the International Conference on Artificial Intelligence and Statistics, 1695–1704. PMLR, 2020.">Janati <em>et al.</em>, 2020</a>]</span>, soft-DTW is not invariant to time
shifts, as is DTW.
Suppose <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> is a time series that is constant except for a motif that
occurs at some point in the series, and let us denote by <span class="math notranslate nohighlight">\(\mathbf{x}_{+k}\)</span> a
copy of <span class="math notranslate nohighlight">\(\mathbf{x}\)</span> in which the motif is temporally shifted by <span class="math notranslate nohighlight">\(k\)</span> timestamps.
Then the quantity</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{equation*}
\left| \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}_{+k}) - \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}) \right|
\end{equation*}\]</div>
<p>grows linearly with <span class="math notranslate nohighlight">\(\gamma k^2\)</span>.
The reason behind this sensibility to time shifts is that soft-DTW provides a
weighted average similarity score across all alignment paths (where stronger
weights are assigned to better paths), instead of focusing on the single best
alignment as done in DTW.</p>
<p>Another important property of soft-DTW is that is has a “denoising effect”, in
the sense that, for a given time series <span class="math notranslate nohighlight">\(\mathbf{y}\)</span>, the minimizer of
<span class="math notranslate nohighlight">\(\text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{y})\)</span> is not <span class="math notranslate nohighlight">\(\mathbf{y}\)</span>
itself but rather a smoothed version:</p>
<figure class="align-default" id="denoising-sdtw">
<a class="reference internal image-reference" href="../../_images/denoising_sdtw.png"><img alt="../../_images/denoising_sdtw.png" src="../../_images/denoising_sdtw.png" style="width: 50%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Denoising effect of soft-DTW.
Here, the optimization problem is
<span class="math notranslate nohighlight">\(\min_\mathbf{x} \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{y})\)</span>
and <span class="math notranslate nohighlight">\(\mathbf{y}\)</span> is used as an initialization for the gradient descent.
This Figure is taken from <span id="id3">[<a class="reference internal" href="#id17" title="Mathieu Blondel, Arthur Mensch, and Jean-Philippe Vert. Differentiable divergences between time series. 2020. arXiv:2010.08354.">Blondel <em>et al.</em>, 2020</a>]</span>.</span><a class="headerlink" href="#denoising-sdtw" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="related-similarity-measures">
<h2>Related Similarity Measures<a class="headerlink" href="#related-similarity-measures" title="Permalink to this heading">#</a></h2>
<p>In <span id="id4">[<a class="reference internal" href="#id17" title="Mathieu Blondel, Arthur Mensch, and Jean-Philippe Vert. Differentiable divergences between time series. 2020. arXiv:2010.08354.">Blondel <em>et al.</em>, 2020</a>]</span>, new similarity measures are defined, that rely on
soft-DTW.</p>
<p>First, <strong>soft-DTW divergence</strong> is defined as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b097c890-a4a9-4413-afba-305a65b00fea">
<span class="eqno">(10)<a class="headerlink" href="#equation-b097c890-a4a9-4413-afba-305a65b00fea" title="Permalink to this equation">#</a></span>\[\begin{equation}
    D^\gamma (\mathbf{x}, \mathbf{x}^\prime) =
        \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}^\prime)
        - \frac{1}{2} \left(
                \text{soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}) +
                \text{soft-}DTW^{\gamma}(\mathbf{x}^\prime, \mathbf{x}^\prime)
            \right)
\end{equation}\]</div>
<p>and this divergence has the advantage of being minimized for
<span class="math notranslate nohighlight">\(\mathbf{x} = \mathbf{x}^\prime\)</span> (and being exactly 0 in that case).</p>
<p>Second, another interesting similarity measure introduced in the same paper is
the <strong>sharp soft-DTW</strong> which is:</p>
<div class="amsmath math notranslate nohighlight" id="equation-8e85a8c3-1734-4aee-aa12-e99664d20f26">
<span class="eqno">(11)<a class="headerlink" href="#equation-8e85a8c3-1734-4aee-aa12-e99664d20f26" title="Permalink to this equation">#</a></span>\[\begin{equation}
    \text{sharp-soft-}DTW^{\gamma} (\mathbf{x}, \mathbf{x}^\prime) =
        \langle A_\gamma,  D_2(\mathbf{x}, \mathbf{x}^\prime) \rangle
\end{equation}\]</div>
<p>Note that a <strong>sharp soft-DTW divergence</strong> can be derived from this
(with a similar approach as for <span class="math notranslate nohighlight">\(D^\gamma\)</span>), which has the extra benefit
(over the sharp soft-DTW) of
being minimized at <span class="math notranslate nohighlight">\(\mathbf{x} = \mathbf{x}^\prime\)</span>.</p>
<p>Further note that, by pushing <span class="math notranslate nohighlight">\(\gamma\)</span> to the <span class="math notranslate nohighlight">\(+\infty\)</span> limit in this formula,
one gets:</p>
<div class="amsmath math notranslate nohighlight" id="equation-b2a4866c-2f23-45be-a190-88ed73ff5734">
<span class="eqno">(12)<a class="headerlink" href="#equation-b2a4866c-2f23-45be-a190-88ed73ff5734" title="Permalink to this equation">#</a></span>\[\begin{equation}
\text{sharp-soft-}DTW^{\gamma}(\mathbf{x}, \mathbf{x}^\prime)
    \xrightarrow{\gamma \to +\infty}
    \left\langle A_\infty, D_2(\mathbf{x}, \mathbf{x}^\prime) \right\rangle \, ,
\end{equation}\]</div>
<p>where <span class="math notranslate nohighlight">\(A_\infty\)</span> tends to favor diagonal matches:</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delannoy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
  <span class="n">numbers</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
  <span class="n">numbers</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">numbers</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:]</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">delannoy_numbers</span> <span class="o">=</span> <span class="n">delannoy</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">weight_matrix</span> <span class="o">=</span> <span class="n">delannoy_numbers</span> <span class="o">*</span> <span class="n">delannoy_numbers</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">delannoy_numbers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">weight_matrix</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$A_\infty$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/2eba0b0e9df4074bbec394c4539b3d4093bcc22f9ce7567f6789e90efef58e9f.svg" src="../../_images/2eba0b0e9df4074bbec394c4539b3d4093bcc22f9ce7567f6789e90efef58e9f.svg" /></div>
</div>
</section>
<section id="barycenters">
<h2>Barycenters<a class="headerlink" href="#barycenters" title="Permalink to this heading">#</a></h2>
<p>Also, <strong>barycenters</strong> for the soft-DTW geometry can be estimated by
minimization of the corresponding loss (<em>cf.</em> Equation <a class="reference internal" href="dtw.html#equation-eq-barycenter">(4)</a>)
through gradient descent.
In such case, the parameters to be optimized are the coordinates of the
barycenter.
This is illustrated in the example below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">tslearn.datasets</span> <span class="kn">import</span> <span class="n">CachedDatasets</span>
<span class="kn">from</span> <span class="nn">tslearn.preprocessing</span> <span class="kn">import</span> <span class="n">TimeSeriesScalerMinMax</span>
<span class="kn">from</span> <span class="nn">tslearn.barycenters</span> <span class="kn">import</span> <span class="n">softdtw_barycenter</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">CachedDatasets</span><span class="p">()</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;Trace&quot;</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">TimeSeriesScalerMinMax</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">pow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]):</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">softdtw_barycenter</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">10</span> <span class="o">**</span> <span class="nb">pow</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">gamma = 10^{</span><span class="si">%d</span><span class="s2">}$&quot;</span> <span class="o">%</span> <span class="nb">pow</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">X_train</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e7b75355d8d6b862ddacbb6a20fa3fd59c4f776d176f7b8d8775b800dad4bb78.svg" src="../../_images/e7b75355d8d6b862ddacbb6a20fa3fd59c4f776d176f7b8d8775b800dad4bb78.svg" /></div>
</div>
<p>Note how large values of <span class="math notranslate nohighlight">\(\gamma\)</span> tend to smooth out the motifs from the input
time series.
The noisy barycenter obtained for low <span class="math notranslate nohighlight">\(\gamma\)</span> can be explained by the fact
that low values of <span class="math notranslate nohighlight">\(\gamma\)</span> lead to a similarity measure that is
less smooth (with the extreme case <span class="math notranslate nohighlight">\(\gamma = 0\)</span> for which DTW is retrieved and
the function faces differentiability issues), making the optimization problem
harder.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<div class="docutils container" id="id5">
<div class="citation" id="id17" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span>BMV20<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id3">1</a>,<a role="doc-backlink" href="#id4">2</a>)</span>
<p>Mathieu Blondel, Arthur Mensch, and Jean-Philippe Vert. Differentiable divergences between time series. 2020. <a class="reference external" href="https://arxiv.org/abs/2010.08354">arXiv:2010.08354</a>.</p>
</div>
<div class="citation" id="id10" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">CB17</a><span class="fn-bracket">]</span></span>
<p>Marco Cuturi and Mathieu Blondel. Soft-DTW: a differentiable loss function for time-series. In <em>Proceedings of the International Conference on Machine Learning</em>, 894–903. JMLR. org, 2017.</p>
</div>
<div class="citation" id="id15" role="doc-biblioentry">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">JCG20</a><span class="fn-bracket">]</span></span>
<p>Hicham Janati, Marco Cuturi, and Alexandre Gramfort. Spatio-temporal alignments: optimal transport through space and time. In <em>Proceedings of the International Conference on Artificial Intelligence and Statistics</em>, 1695–1704. PMLR, 2020.</p>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./contents/align"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="dtw.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Dynamic Time Warping</p>
      </div>
    </a>
    <a class="right-next"
       href="align4ml.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Alignment-based Metrics in Machine Learning</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#definition">Definition</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#soft-alignment-path">Soft-Alignment Path</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#properties">Properties</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#related-similarity-measures">Related Similarity Measures</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#barycenters">Barycenters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Romain Tavenard
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>